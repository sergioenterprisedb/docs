---
title: "Regenerating the server self-signed SSL certificates"
---

If the PEM server certificates are expiring, you can regenerate the certificates and key files.

Perform the steps to replace the self-signed SSL certificates:

1. Stop all running PEM agents, first on the server host and then on any monitored host:

   ```shell
   # Running as root
   systemctl stop pemagent
   ```

   On Windows, you can use the Services applet to stop the PEM agent. The PEM agent service is named Postgres Enterprise Manager Agent. Select the service name in the Services dialog box and select **Stop the service**.

1. Take a backup of the existing SSL certificates and keys:

    ```shell
   # Running as root
   cd /var/lib/edb/as<x>/data
   mkdir certs
   mv server.* root.* ca_* certs/
   ```

1. Use the openssl command to generate the `ca_key.key` file:

   ```shell
   openssl genrsa -out ca_key.key 4096 
   ```

1. Move the `ca_key.key` file to the data directory of the backend server and change the permissions:

   ```shell
   mv ca_key.key /var/lib/edb/as<x>/data
   chmod 600 /var/lib/edb/as<x>/data/ca_key.key
   ```

1. Use the `ca_key.key` to generate the `ca_certificate.crt` file:

   ```shell
   openssl req -x509 -nodes -days 3650 -newkey rsa:4096 -keyout ca_key.key -out ca_ceritificate.crt
   ```

1. Change the permissions of the `ca_certificate.crt` file:

   ```shell
   chmod 600 /var/lib/edb/as<x>/data/ca_certificate.crt
   ```

1. Reuse the `ca_certificate.crt` file as the `root.crt` file:

   ```shell
   cp /var/lib/edb/as<x>/data/ca_certificate.crt /var/lib/edb/as<x>/data/root.crt
   ```
  
1. Change the owner and permissions on the `root.crt` file:

   ```shell
   chown enterprisedb /var/lib/edb/as<x>/data/root.crt
   chmod 600 /var/lib/edb/as<x>/data/root.crt
   ```

9. Use the `openssl_rsa_generate_crl()` function to create the certificate revocation list (`root.crl`):

   ```shell
   /usr/edb/as<x>/bin/psql -U enterprisedb -d pem --no-psqlrc -t -A -c
   "SELECT openssl_rsa_generate_crl('/var/lib/edb/as<x>/data/ca_certificate.crt', '/var/lib/edb/as<x>/data/ca_key.key')" > /var/lib/edb/as<x>/data/root.crl
   ```

10. Change the permissions of the `root.crl` file:

    ```shell
    chmod 600 /var/lib/edb/as<x>/data/root.crl
    ```

11. Use the openssl command to generate the `server.key` file:

    ```shell
    openssl genrsa -out server.key 4096 
    ```

12. Move the `server.key` to the data directory of the backend server and change the permissions:

    ```shell
    mv server.key /var/lib/edb/as<x>/data
    chmod 600 /var/lib/edb/as<x>/data/server.key
    ```

13. Use the openssl req command to create the CSR:

   ```shell
   openssl req -new -key server.key -out server.csr -subj '/C=IN/ST=MH/L=Pune/O=EDB/CN=PEM'
   ```

   Where `-subj` can be provided as per your requirements. You can define `CN` as hostname/domain name of the PEM server host. 

14. Use the openssl x509 command to sign the CSR and generate a server certificate. Move the `server.crt` to the data directory of the backend database server:

    ```shell
    openssl x509 -req -days 365 -in server.csr -CA ca_ceritificate.crt -CAkey ca_key.key -CAcreateserial -out server.crt
    mv server.crt /var/lib/edb/as<x>/data
    ```

    The -req option indicates that the input is a CSR, and the `-CA` and `-CAkey` options specify the root certificate and private key to use for signing the CSR.

14. Change the owner and the permissions on the `server.crt` file:

    ```shell
    chown enterprisedb /var/lib/edb/as<x>/data/server.crt
    chmod 600 /var/lib/edb/as<x>/data/server.crt
    ```

15. Regenerate each PEM agent's self-signed SSL certificates. For more information see,(/pem/latest/certificates/regenerating_agent_certificates).

16. Restart the PEM server:

    ```shell
    systemctl restart edb-as-<x>
    ```
    
    Restarting the backend database server, restarts the PEM server.

17. Start the PEM agent service:

   - On Linux,

   ```shell
   # Running as root
   systemctl start pemagent
   ```

   - On a Windows, you can use the Services applet to start the PEM agent. The PEM agent service is named Postgres Enterprise Manager Agent. Select the service name in the Services dialog box and select **Start the service**.

